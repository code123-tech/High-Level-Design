events {}

http {
    upstream backend {
        # Round Robin: default behavior when servers are simply listed
        server app1:80;
        server app2:80;

        # Optional passive health behavior (fail test on errors)
        # server app1:80 max_fails=2 fail_timeout=5s;
        # server app2:80 max_fails=2 fail_timeout=5s;
    }

    server {
        listen 80;
        access_log /var/log/nginx/access.log;
        location / {
            proxy_pass http://backend;
            proxy_set_header Host $host;
            proxy_set_header X-Forwarded-For $remote_addr;
        }

        # Dev-only metrics endpoint
        location /nginx_status {
            stub_status;
            access_log off;
        }
    }
}

# L4/TCP passthrough demo (no HTTP awareness)
stream {
    upstream tcp_backend {
        server app1:80;
        server app2:80;
        # least_conn; # uncomment to try TCP least_conn
    }
    server {
        listen 9000;
        proxy_pass tcp_backend;
    }
}